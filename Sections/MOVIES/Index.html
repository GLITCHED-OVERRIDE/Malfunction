<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{
  --bg:#000; --panel:#111; --text:#fff; --muted:#bbb; --accent:red;
  --sidebar-w:150px; --radius:12px; --trans:.22s;
}
*{margin:0;padding:0;box-sizing:border-box}
body{display:flex;height:100vh;font-family:Inter,sans-serif;background:var(--bg);color:var(--text);overflow:hidden}
#sidebar{
  width:var(--sidebar-w); background:#070707; display:flex; flex-direction:column;
  padding:14px 10px; border-right:2px solid var(--accent); position:fixed; top:0; bottom:0; gap:10px;
}
#sidebarSearch{
  width:100%; padding:10px; border-radius:10px; background:rgba(255,255,255,0.02);
  border:1px solid rgba(255,255,255,0.03); color:var(--text); outline:none;
}
.sideButtons{width:100%; display:flex; flex-direction:column; gap:8px; margin-top:6px;}
.btn{width:100%; padding:10px; border-radius:10px; text-align:left; background:transparent; color:var(--muted);
border:1px solid rgba(255,255,255,0.02); cursor:pointer; font-weight:700; transition:all var(--trans);}
.btn:hover{background: rgba(255,255,255,0.02); color:#fff; transform:translateX(6px);}
.btn.active{background: rgba(255,255,255,0.035); color:#fff;}
#main{margin-left:var(--sidebar-w); padding:18px; overflow:auto; flex:1; min-height:100vh;}
.section-title{font-weight:700;margin-bottom:8px;font-size:16px;color:#fff;}
.movie-row{display:flex;gap:12px;overflow-x:auto;flex-wrap:wrap;}
.movie{width:160px;cursor:pointer;}
.movie img{width:100%;border-radius:8px;}
#detailPage img{border-radius:12px;}
#playerFrame{width:100%;height:520px;border:none;border-radius:12px;background:#000;}
.season-btn,.episode-btn{
  background:#111;color:#fff;border:none;padding:6px 10px;margin:4px;border-radius:6px;cursor:pointer;transition:.2s;
}
.season-btn:hover,.episode-btn:hover{background:#fff;color:#000;}
@media(max-width:900px){#detailPage img{width:220px;} #playerFrame{height:320px;}}
#trendingBox{position:relative;width:100%;height:400px;overflow:hidden;margin-bottom:16px;}
#trendingBox img{width:100%;height:100%;object-fit:cover;border-radius:12px;}
#trendingOverlay{position:absolute;bottom:20px;left:20px;color:#fff;text-shadow:0 0 8px #000;}
</style>
</head>
<body>

<aside id="sidebar">
  <input id="sidebarSearch" type="search" placeholder="Search movies & TV...">
  <div class="sideButtons">
    <button class="btn active" data-panel="home">Home</button>
    <button class="btn" data-panel="movies">Movies</button>
    <button class="btn" data-panel="tv">TV</button>
  </div>
</aside>

<main id="main">Loading...</main>

<script>
const API_KEY="0e33c92186263620ce8c7f6b8fb35b00";
const API_URL="https://api.themoviedb.org/3";
const IMG_500="https://image.tmdb.org/t/p/w500";
const FALLBACK="https://dummyimage.com/500x750/111/fff&text=No+Image";

const main=document.getElementById("main");
const buttons=document.querySelectorAll(".btn");
let searchTimeout;

// ---------------- Utility: create card ----------------
function createCard(item,type){
  const div=document.createElement("div"); div.className="movie";
  div.innerHTML=`<img src="${item.poster_path?IMG_500+item.poster_path:FALLBACK}"><div style="text-align:center;margin-top:4px">${item.title||item.name}</div>`;
  div.onclick=()=>openDetail(item,type); return div;
}

// ---------------- Sidebar button click ----------------
buttons.forEach(btn=>{
  btn.addEventListener("click", ()=>{
    buttons.forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    loadPanel(btn.dataset.panel);
  });
});

// ---------------- Sidebar search ----------------
document.getElementById("sidebarSearch").addEventListener("input",e=>{
  const q=e.target.value.trim();
  clearTimeout(searchTimeout);
  searchTimeout=setTimeout(()=>{q?doSearch(q):loadPanel("home");},300);
});
async function doSearch(query){
  const res=await fetch(`${API_URL}/search/multi?api_key=${API_KEY}&query=${encodeURIComponent(query)}`);
  const data=await res.json();
  main.innerHTML=`<section><h3 class="section-title">Results for "${query}"</h3><div class="movie-row" id="searchRow"></div></section>`;
  const row=document.getElementById("searchRow");
  data.results.filter(r=>r.media_type==="movie"||r.media_type==="tv").forEach(r=>row.appendChild(createCard(r,r.media_type)));
}

// ---------------- Detail ----------------
async function openDetail(item,mediaType){
  main.innerHTML=`
    <section id="detailPage">
      <div style="display:flex;flex-wrap:wrap;gap:16px;">
        <img id="detailPoster" src="" style="width:320px;flex-shrink:0;">
        <div style="flex:1;display:flex;flex-direction:column;gap:12px;">
          <h1 id="detailTitle"></h1>
          <p id="detailOverview" style="color:#bbb;line-height:1.5;font-size:15px;"></p>
          <p><strong>Rating:</strong> <span id="detailRating"></span></p>
          <div id="tvControls" style="display:none;">
            <div style="font-weight:700;">Seasons</div><div id="seasonList" style="display:flex;gap:8px;flex-wrap:wrap;"></div>
            <div style="font-weight:700;margin-top:6px;">Episodes</div><div id="episodeList" style="display:flex;flex-direction:column;gap:4px;"></div>
          </div>
        </div>
      </div>
      <div style="margin-top:14px;"><iframe id="playerFrame" allowfullscreen></iframe></div>
    </section>`;
  
  document.getElementById("detailPoster").src=item.poster_path?IMG_500+item.poster_path:FALLBACK;
  document.getElementById("detailTitle").textContent=item.title||item.name;
  document.getElementById("detailOverview").textContent=item.overview||"No description";
  document.getElementById("detailRating").textContent=(item.vote_average||0).toFixed(1);
  
  const player=document.getElementById("playerFrame");
  const tvControls=document.getElementById("tvControls");
  const seasonList=document.getElementById("seasonList");
  const episodeList=document.getElementById("episodeList");

  if(mediaType==="tv"){
    tvControls.style.display="block";
    seasonList.innerHTML="Loading..."; episodeList.innerHTML="";
    const tv=await fetch(`${API_URL}/tv/${item.id}?api_key=${API_KEY}`).then(r=>r.json());
    seasonList.innerHTML="";
    tv.seasons.forEach(s=>{
      const b=document.createElement("button"); b.className="season-btn"; b.textContent="S"+s.season_number;
      b.onclick=async ()=>{
        Array.from(seasonList.children).forEach(x=>x.style.background="#111"); b.style.background="#fff"; b.style.color="#000";
        episodeList.innerHTML="Loading...";
        const eps=await fetch(`${API_URL}/tv/${item.id}/season/${s.season_number}?api_key=${API_KEY}`).then(r=>r.json());
        episodeList.innerHTML="";
        eps.episodes.forEach(ep=>{
          const eb=document.createElement("button"); eb.className="episode-btn";
          eb.textContent=`Ep ${ep.episode_number}: ${ep.name}`;
          eb.onclick=()=>player.src=`https://player.videasy.net/tv/${item.id}/${s.season_number}/${ep.episode_number}`;
          episodeList.appendChild(eb);
        });
      };
      seasonList.appendChild(b);
    });
  }else{
    tvControls.style.display="none";
    player.src=`https://player.videasy.net/movie/${item.id}`;
  }

  // Recently watched
  let rec=JSON.parse(localStorage.getItem("recent")||"[]");
  rec=rec.filter(x=>x.id!==item.id); rec.unshift({...item,type:mediaType}); if(rec.length>12) rec.pop();
  localStorage.setItem("recent",JSON.stringify(rec));
}

// ---------------- Panels ----------------
async function loadPanel(panel){
  main.innerHTML="Loading...";
  if(panel==="home"){
    main.innerHTML=`
      <section id="trendingSection"><div id="trendingBox"><div id="trendingOverlay"></div></div></section>
      <section id="recentWrapper" style="display:none;"><h3 class="section-title">Recently Watched</h3><div id="recentList" class="movie-row"></div></section>
      <section><h3 class="section-title">Popular Movies</h3><div id="homePopularMovies" class="movie-row"></div></section>
      <section><h3 class="section-title">Popular TV Shows</h3><div id="homePopularTV" class="movie-row"></div></section>`;
    
    // Recently watched
    const recentList=document.getElementById("recentList");
    const rec=JSON.parse(localStorage.getItem("recent")||"[]");
    if(rec.length){recentList.innerHTML=""; rec.forEach(i=>recentList.appendChild(createCard(i,i.type))); document.getElementById("recentWrapper").style.display="block";}
    
    // Popular
    const homePopularMovies=document.getElementById("homePopularMovies");
    const homePopularTV=document.getElementById("homePopularTV");
    (await (await fetch(`${API_URL}/movie/popular?api_key=${API_KEY}`)).json()).results.forEach(i=>homePopularMovies.appendChild(createCard(i,"movie")));
    (await (await fetch(`${API_URL}/tv/popular?api_key=${API_KEY}`)).json()).results.forEach(i=>homePopularTV.appendChild(createCard(i,"tv")));
    
    // Trending carousel large
    const trendingBox=document.getElementById("trendingBox");
    const trendingOverlay=document.getElementById("trendingOverlay");
    const trending=await (await fetch(`${API_URL}/trending/all/week?api_key=${API_KEY}`)).json();
    let index=0;
    function showTrend(){
      if(!trending.results.length)return;
      const t=trending.results[index%trending.results.length];
      trendingBox.innerHTML=`<img src="${t.backdrop_path?IMG_500+t.backdrop_path:FALLBACK}"><div id="trendingOverlay"><h2>${t.title||t.name}</h2></div>`;
      trendingBox.querySelector("img").onclick=()=>openDetail(t,t.media_type);
      index++;
    }
    showTrend();
    setInterval(showTrend,20000);
  }

  if(panel==="movies"){
    main.innerHTML=`<section><h3 class="section-title">Popular Movies</h3><div id="popularMovies" class="movie-row"></div></section>
    <section><h3 class="section-title">Top Rated Movies</h3><div id="topRatedMovies" class="movie-row"></div></section>`;
    const popularMovies=document.getElementById("popularMovies");
    const topMovies=document.getElementById("topRatedMovies");
    (await (await fetch(`${API_URL}/movie/popular?api_key=${API_KEY}`)).json()).results.forEach(i=>popularMovies.appendChild(createCard(i,"movie")));
    (await (await fetch(`${API_URL}/movie/top_rated?api_key=${API_KEY}`)).json()).results.forEach(i=>topMovies.appendChild(createCard(i,"movie")));
  }

  if(panel==="tv"){
    main.innerHTML=`<section><h3 class="section-title">Popular TV Shows</h3><div id="popularTV" class="movie-row"></div></section>
    <section><h3 class="section-title">Top Rated TV Shows</h3><div id="topRatedTV" class="movie-row"></div></section>`;
    const popularTV=document.getElementById("popularTV");
    const topTV=document.getElementById("topRatedTV");
    (await (await fetch(`${API_URL}/tv/popular?api_key=${API_KEY}`)).json()).results.forEach(i=>popularTV.appendChild(createCard(i,"tv")));
    (await (await fetch(`${API_URL}/tv/top_rated?api_key=${API_KEY}`)).json()).results.forEach(i=>topTV.appendChild(createCard(i,"tv")));
  }
}

// ---------------- INIT ----------------
loadPanel("home");
</script>

</body>
</html>
