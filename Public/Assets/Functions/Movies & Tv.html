<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GlitchFlix</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>
body{margin:0;font-family:'Poppins',sans-serif;background:#111;color:#fff;display:flex;overflow-x:hidden}
#sidebar{width:220px;background:#000;border-right:2px solid #fff;display:flex;flex-direction:column;height:100vh;position:fixed;top:0;left:0}
#sidebar h2{color:#fff;text-align:center;padding:15px 0;margin:0;font-size:1.5rem;border-bottom:1px solid #fff;}
#sidebar button{background:none;border:none;color:#fff;padding:15px;text-align:left;cursor:pointer;font-size:1rem;transition:.3s;border-left:5px solid transparent}
#sidebar button.active,#sidebar button:hover{border-left:5px solid #fff;color:#fff}
#sidebarFooter {margin-top:auto;text-align:center;padding:15px 0;font-size:0.9rem;color:#fff;border-top:1px solid #fff;}
#mainContent{margin-left:220px;padding:20px;width:calc(100% - 220px);overflow-y:auto;flex:1}
.tabContent{display:none}
.tabContent.active{display:block}
.section-title{font-size:1.4rem;color:#fff;margin:20px 0 10px;border-left:5px solid #fff;padding-left:10px}
.movie-row{display:flex;overflow-x:auto;padding-bottom:20px;gap:15px;scroll-behavior:smooth}
.movie{flex:0 0 auto;width:180px;background:#000;border-radius:10px;cursor:pointer;transition:.3s;position:relative}
.movie:hover{transform:scale(1.05);box-shadow:0 0 10px #fff}
.movie img{width:100%;height:270px;object-fit:cover;border-bottom:2px solid #fff}
.movie-info{text-align:center;padding:8px;color:#fff}
.movie-info h3{font-size:1rem;margin:0}

/* Overlay */
#detailOverlay,#videoOverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.95);z-index:3000;padding:20px;overflow-y:auto;color:#fff}
#detailOverlay.show,#videoOverlay.show{display:block}
.overlayContent{display:flex;flex-wrap:wrap;gap:20px;max-width:1000px;margin:0 auto;background:#000;padding:20px;border-radius:10px}
.overlayContent img{width:320px;height:450px;object-fit:cover;border-radius:10px;flex-shrink:0}
.overlayContent .details{flex:1;display:flex;flex-direction:column}
#closeDetail,#closeVideo{position:absolute;top:15px;right:25px;font-size:2rem;cursor:pointer;color:#fff}
#player{margin-top:14px;width:100%;height:520px;border:none;border-radius:10px}

/* Episode list */
.season-btn,.episode-btn{background:#000;color:#fff;border:1px solid #fff;padding:6px 10px;margin:5px;border-radius:5px;cursor:pointer}
.season-btn.active,.episode-btn.active{background:#fff;color:#000}

/* Search */
.searchBar{margin:10px 0;display:flex;gap:10px}
.searchBar input{flex:1;padding:10px;font-size:1rem;border-radius:5px;border:1px solid #fff;background:#000;color:#fff;outline:none}
.searchBar button{padding:10px;border:none;background:#000;color:#fff;border-radius:5px;cursor:pointer;border:1px solid #fff}

@media(max-width:800px){.overlayContent img{width:220px;height:320px}#player{height:320px}}
</style>
</head>
<body>

<div id="sidebar">
<h2>GlitchFlix</h2>
<button class="tabBtn active" data-tab="dashboard">Dashboard</button>
<button class="tabBtn" data-tab="movies">Movies</button>
<button class="tabBtn" data-tab="tv">TV</button>
<div id="sidebarFooter">V2 by Glitch Override</div>
</div>

<div id="mainContent">
<div id="dashboard" class="tabContent active">
<h2 class="section-title">Recently Watched</h2>
<div class="movie-row" id="recentList"></div>
</div>

<div id="movies" class="tabContent">
<div class="searchBar">
<input type="text" placeholder="Search Movies..." id="movieSearch">
</div>
<div id="movieContent">
<h2 class="section-title">Popular Movies</h2>
<div class="movie-row" id="popularMovies"></div>
<h2 class="section-title">Top Rated Movies</h2>
<div class="movie-row" id="topRatedMovies"></div>
</div>
<div class="movie-row" id="movieSearchResults" style="display:none;"></div>
</div>

<div id="tv" class="tabContent">
<div class="searchBar">
<input type="text" placeholder="Search TV Shows..." id="tvSearch">
</div>
<div id="tvContent">
<h2 class="section-title">Popular TV Shows</h2>
<div class="movie-row" id="popularTV"></div>
<h2 class="section-title">Top Rated TV Shows</h2>
<div class="movie-row" id="topRatedTV"></div>
</div>
<div class="movie-row" id="tvSearchResults" style="display:none;"></div>
</div>
</div>

<!-- Detail Overlay -->
<div id="detailOverlay">
<div id="closeDetail">&times;</div>
<div class="overlayContent">
<img id="detailPoster" src="">
<div class="details">
<h2 id="detailTitle"></h2>
<p><strong>Rating:</strong> <span id="detailRating"></span></p>
<p id="detailOverview"></p>
<div id="seasons"></div>
<div id="episodes"></div>
</div>
</div>
</div>

<!-- Video Overlay -->
<div id="videoOverlay">
<div id="closeVideo">&times;</div>
<iframe id="player" allowfullscreen></iframe>
</div>

<script>
const API_KEY="0e33c92186263620ce8c7f6b8fb35b00";
const API_URL="https://api.themoviedb.org/3";
const IMAGE_BASE="https://image.tmdb.org/t/p/w500";
const FALLBACK="https://dummyimage.com/300x450/111/ffffff&text=No+Image";

// Tabs
document.querySelectorAll(".tabBtn").forEach(btn=>{
btn.addEventListener("click",()=>{
document.querySelectorAll(".tabBtn").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
document.querySelectorAll(".tabContent").forEach(c=>c.classList.remove("active"));
document.getElementById(btn.dataset.tab).classList.add("active");
});
});

// Card
function createCard(item,type){
const div=document.createElement("div"); div.className="movie";
const img=document.createElement("img"); img.src=item.poster_path?IMAGE_BASE+item.poster_path:FALLBACK;
const info=document.createElement("div"); info.className="movie-info";
info.innerHTML=`<h3>${item.title||item.name}</h3>`;
div.appendChild(img); div.appendChild(info);
div.onclick=()=> type==="tv"?showTVDetail(item):showMovieDetail(item);
return div;
}

// Render row
async function renderRow(url,container,type){
const res=await fetch(url); const data=await res.json();
container.innerHTML=""; if(data.results)data.results.forEach(i=>container.appendChild(createCard(i,type)));
}

// Recently watched
function saveRecentlyWatched(item,type){
let arr=JSON.parse(localStorage.getItem("recent")||"[]");
arr=arr.filter(x=>x.id!==item.id); arr.unshift({...item,type}); if(arr.length>10) arr.pop();
localStorage.setItem("recent",JSON.stringify(arr)); renderRecentlyWatched();
}
function renderRecentlyWatched(){
const recentList=document.getElementById("recentList");
let arr=JSON.parse(localStorage.getItem("recent")||"[]");
recentList.innerHTML=""; arr.forEach(item=>recentList.appendChild(createCard(item,item.type)));
}

// Detail Overlays
const detailOverlay=document.getElementById("detailOverlay"),
detailPoster=document.getElementById("detailPoster"),
detailTitle=document.getElementById("detailTitle"),
detailRating=document.getElementById("detailRating"),
detailOverview=document.getElementById("detailOverview"),
seasonsEl=document.getElementById("seasons"),
episodesEl=document.getElementById("episodes"),
videoOverlay=document.getElementById("videoOverlay"),
player=document.getElementById("player");

document.getElementById("closeDetail").onclick=()=>{detailOverlay.classList.remove("show");episodesEl.innerHTML="";seasonsEl.innerHTML="";}
document.getElementById("closeVideo").onclick=()=>{videoOverlay.classList.remove("show");player.src="";};

// Movies
function showMovieDetail(item){
detailPoster.src=item.poster_path?IMAGE_BASE+item.poster_path:FALLBACK;
detailTitle.textContent=item.title;
detailRating.textContent=(item.vote_average||0).toFixed(1);
detailOverview.textContent=item.overview||"No description";
detailOverlay.classList.add("show");
player.src=`https://player.videasy.net/movie/${item.id}`;
videoOverlay.classList.add("show");
saveRecentlyWatched(item,"movie");
}

// TV Detail
let currentTV=null;
async function showTVDetail(item){
currentTV=item;
detailPoster.src=item.poster_path?IMAGE_BASE+item.poster_path:FALLBACK;
detailTitle.textContent=item.name;
detailRating.textContent=(item.vote_average||0).toFixed(1);
detailOverview.textContent=item.overview||"No description";
seasonsEl.innerHTML=""; episodesEl.innerHTML="";
const tvData=await fetch(`${API_URL}/tv/${item.id}?api_key=${API_KEY}`).then(r=>r.json());
tvData.seasons.forEach(s=>{
const btn=document.createElement("button"); btn.className="season-btn"; btn.textContent="S"+s.season_number;
btn.onclick=()=>loadEpisodes(item.id,s.season_number,btn);
seasonsEl.appendChild(btn);
});
detailOverlay.classList.add("show");
saveRecentlyWatched(item,"tv");
}

async function loadEpisodes(tvId,seasonNum,btn){
document.querySelectorAll(".season-btn").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
episodesEl.innerHTML="";
const seasonData=await fetch(`${API_URL}/tv/${tvId}/season/${seasonNum}?api_key=${API_KEY}`).then(r=>r.json());
seasonData.episodes.forEach(ep=>{
const b=document.createElement("button"); b.className="episode-btn"; b.textContent="Ep"+ep.episode_number+": "+ep.name;
b.onclick=()=>{player.src=`https://player.videasy.net/tv/${tvId}/${seasonNum}/${ep.episode_number}`; videoOverlay.classList.add("show");};
episodesEl.appendChild(b);
});
}

// Auto Search
document.getElementById("movieSearch").addEventListener("input", async ()=>{
const q=document.getElementById("movieSearch").value.trim();
const content=document.getElementById("movieContent");
const results=document.getElementById("movieSearchResults");
if(!q){content.style.display="block"; results.style.display="none"; return;}
const res=await fetch(`${API_URL}/search/movie?api_key=${API_KEY}&query=${encodeURIComponent(q)}`);
const data=await res.json();
results.innerHTML=""; if(data.results)data.results.forEach(i=>results.appendChild(createCard(i,"movie")));
content.style.display="none"; results.style.display="flex";
});

document.getElementById("tvSearch").addEventListener("input", async ()=>{
const q=document.getElementById("tvSearch").value.trim();
const content=document.getElementById("tvContent");
const results=document.getElementById("tvSearchResults");
if(!q){content.style.display="block"; results.style.display="none"; return;}
const res=await fetch(`${API_URL}/search/tv?api_key=${API_KEY}&query=${encodeURIComponent(q)}`);
const data=await res.json();
results.innerHTML=""; if(data.results)data.results.forEach(i=>results.appendChild(createCard(i,"tv")));
content.style.display="none"; results.style.display="flex";
});

// Init
(async function(){
renderRecentlyWatched();
await renderRow(`${API_URL}/movie/popular?api_key=${API_KEY}`,document.getElementById("popularMovies"),"movie");
await renderRow(`${API_URL}/movie/top_rated?api_key=${API_KEY}`,document.getElementById("topRatedMovies"),"movie");
await renderRow(`${API_URL}/tv/popular?api_key=${API_KEY}`,document.getElementById("popularTV"),"tv");
await renderRow(`${API_URL}/tv/top_rated?api_key=${API_KEY}`,document.getElementById("topRatedTV"),"tv");
})();
</script>
</body>
  </html>
