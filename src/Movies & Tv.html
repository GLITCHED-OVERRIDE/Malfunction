<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Movies & Tv</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>
:root{
  --bg:#000;
  --card:#0f0f0f;
  --muted:#222;
  --text:#fff;
  --accent:#ff0000;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter, "Poppins", Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
}

.headerWrap{
  width:100%;
  background:var(--card);
  border-bottom:3px solid var(--accent);
  position:fixed; top:0; left:0; z-index:1200;
}
.headerInner{
  max-width:1200px;
  margin:0 auto;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:18px;
  height:72px;
  padding:0 12px;
}
.tabBtn{
  background:none;
  border:0;
  color:var(--text);
  font-size:16px;
  padding:12px 14px;
  cursor:pointer;
  display:flex;
  gap:8px;
  align-items:center;
  border-bottom:3px solid transparent;
  transition:.18s;
}
.tabBtn:hover{ color:var(--accent); border-bottom-color:var(--accent) }
.tabBtn.active{ color:var(--accent); border-bottom-color:var(--accent) }

#mainContent{ max-width:1200px; margin:92px auto 40px; padding:0 14px; }

.section-title{ font-size:1.25rem; margin:15px 0 10px; padding-left:12px; border-left:5px solid var(--accent); }

.movie-row{ display:flex; gap:14px; overflow-x:auto; padding-bottom:18px; scroll-behavior:smooth; }
.movie{ width:180px; background:var(--card); border-radius:10px; border:2px solid var(--muted); overflow:hidden; cursor:pointer; flex:0 0 auto; transition:.18s; }
.movie:hover{ transform:scale(1.05); border-color:var(--accent); box-shadow:0 0 16px rgba(255,0,0,.12); }
.movie img{ width:100%; height:270px; object-fit:cover; display:block; border-bottom:3px solid var(--accent); }
.movie-info{ padding:8px; text-align:center; color:var(--text) }

.search-area{ margin:16px 0 22px; }
#searchInput{ width:100%; padding:12px; border-radius:8px; border:2px solid var(--accent); background:#030303; color:var(--text); font-size:1rem; outline:none; }

/* NEW — SEARCH GRID 5 PER ROW */
#searchResults {
  display:grid !important;
  grid-template-columns: repeat(5, 1fr);
  gap:20px;
  padding:20px 0;
}
#searchResults.movie-row { overflow-x:unset !important; }

/* overlays */
#detailOverlay,#videoOverlay{
  display:none; position:fixed; inset:0;
  background:rgba(0,0,0,.95); z-index:1600; padding:20px; overflow-y:auto;
}
#detailOverlay.show,#videoOverlay.show{ display:block; }
#closeDetail,#closeVideo{
  position:fixed; top:14px; right:18px;
  font-size:28px; color:var(--accent); cursor:pointer; z-index:1700;
}

.overlayContent{
  max-width:1100px; margin:40px auto;
  background:var(--card); padding:18px;
  border-radius:10px; display:flex; gap:18px; border:2px solid var(--accent);
  flex-wrap:wrap;
}
.overlayContent img{
  width:320px; height:460px;
  object-fit:cover; border-radius:8px; border:2px solid var(--accent)
}
.overlayContent .details{ flex:1; min-width:260px; color:var(--text) }

.season-btn,.episode-btn{
  margin:6px 6px 6px 0; padding:8px 12px;
  background:transparent; border:2px solid var(--accent);
  color:var(--text); border-radius:6px; cursor:pointer;
}
.season-btn.active,.episode-btn.active{
  background:var(--accent); color:#000;
}

#player{ width:100%; height:75vh; border:none; border-radius:8px; background:#000; }

@media(max-width:900px){
  .overlayContent img{ width:240px; height:340px }
  .movie img{ height:220px }
  #mainContent{ margin-top:102px }
}
</style>
</head>
<body>

<header class="headerWrap">
  <div class="headerInner">

    <button class="tabBtn active" data-tab="home"><i class="fa-solid fa-house"></i> Home</button>
    <button class="tabBtn" data-tab="movies"><i class="fa-solid fa-film"></i> Movies</button>
    <button class="tabBtn" data-tab="series"><i class="fa-solid fa-tv"></i> Series</button>
    <button class="tabBtn" data-tab="search"><i class="fa-solid fa-magnifying-glass"></i> Search</button>

  </div>
</header>

<main id="mainContent">

  <!-- HOME TAB -->
  <section id="home" class="tabContent active">
    <h2 class="section-title">Recently Watched</h2>
    <div id="recentList" class="movie-row"></div>
    <p style="color:#bbb; margin-top:12px;">Your recently watched items will show here.</p>
  </section>

  <!-- MOVIES -->
  <section id="movies" class="tabContent" style="display:none">
    <h2 class="section-title">Movies</h2>

    <h3>Popular Movies</h3>
    <div id="popularMovies" class="movie-row"></div>

    <h3>Top Rated Movies</h3>
    <div id="topRatedMovies" class="movie-row"></div>

    <h3>Upcoming Movies</h3>
    <div id="upcomingMovies" class="movie-row"></div>

    <h3>Now Playing</h3>
    <div id="nowPlayingMovies" class="movie-row"></div>
  </section>

  <!-- SERIES -->
  <section id="series" class="tabContent" style="display:none">
    <h2 class="section-title">Series</h2>

    <h3>Popular Series</h3>
    <div id="popularSeries" class="movie-row"></div>

    <h3>Top Rated Series</h3>
    <div id="topRatedSeries" class="movie-row"></div>

    <h3>Airing Today</h3>
    <div id="airingToday" class="movie-row"></div>

    <h3>On The Air</h3>
    <div id="onTheAir" class="movie-row"></div>
  </section>

  <!-- SEARCH -->
  <section id="search" class="tabContent" style="display:none">
    <div class="search-area">
      <input id="searchInput" placeholder="Search movies or series..." />
    </div>
    <div id="searchResults" class=""></div>
  </section>

</main>

<!-- DETAIL -->
<div id="detailOverlay">
  <div id="closeDetail" onclick="closeDetail()">✕</div>
  <div id="detailContainer"></div>
</div>

<!-- PLAYER -->
<div id="videoOverlay">
  <div id="closeVideo" onclick="closeVideo()">✕</div>
  <iframe id="player" allowfullscreen></iframe>
</div>

<script>
const API_KEY = "0e33c92186263620ce8c7f6b8fb35b00";
const API_URL = "https://api.themoviedb.org/3";
const IMAGE = "https://image.tmdb.org/t/p/w500";
const FALLBACK = "https://dummyimage.com/300x450/111/ffffff&text=No+Image";

const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);
function el(t,c){ const d=document.createElement(t); if(c)d.className=c; return d; }

/* TAB SWITCHING */
function switchTab(id){
  $$('.tabBtn').forEach(b=>b.classList.remove("active"));
  $$('.tabBtn').forEach(b=>{ if(b.dataset.tab===id) b.classList.add("active") });
  $$('.tabContent').forEach(t=>t.style.display="none");
  const show=document.getElementById(id);
  if(show) show.style.display="block";
}
$$('.tabBtn').forEach(btn=>btn.addEventListener("click",()=>switchTab(btn.dataset.tab)));
switchTab("home");

/* CARD CREATOR */
function createCard(item,type){
  const w=el('div','movie');
  const img=el('img');
  img.src=item.poster_path?IMAGE+item.poster_path:FALLBACK;
  const info=el('div','movie-info');
  const h=el('h3'); h.textContent=item.title||item.name;
  info.appendChild(h);
  w.appendChild(img); w.appendChild(info);
  w.onclick=()=>{ type==="tv"?openTVDetail(item):openMovieDetail(item); };
  return w;
}

/* RENDER ROW */
async function renderRow(url,sel,type){
  const c=document.querySelector(sel);
  if(!c)return;
  c.innerHTML="Loading...";
  try{
    const r=await fetch(url); const d=await r.json();
    c.innerHTML="";
    if(!d.results||!d.results.length){ c.innerHTML="No items"; return; }
    d.results.forEach(i=>c.appendChild(createCard(i,type)));
  }catch{ c.innerHTML="Failed to load"; }
}

/* RECENTLY WATCHED SAVE */
function saveRecentlyWatched(it,type){
  let arr=JSON.parse(localStorage.getItem("gf_recent")||"[]");
  arr = arr.filter(x => !(x.id===it.id && x._type===type));
  arr.unshift({...it,_type:type});
  if(arr.length>30) arr.pop();
  localStorage.setItem("gf_recent",JSON.stringify(arr));
  renderRecentlyWatched();
}
function renderRecentlyWatched(){
  const l=$("#recentList");
  l.innerHTML="";
  const arr=JSON.parse(localStorage.getItem("gf_recent")||"[]");
  arr.forEach(it=>l.appendChild(createCard(it,it._type)));
}

/* DETAIL OVERLAY */
function closeDetail(){ $("#detailOverlay").classList.remove("show"); $("#detailOverlay").style.display="none"; }
function openDetailHtml(html){
  $("#detailContainer").innerHTML=html;
  $("#detailOverlay").style.display="block";
  $("#detailOverlay").classList.add("show");
}
$("#detailOverlay").onclick=e=>{ if(e.target.id==="detailOverlay") closeDetail(); };

/* MOVIE DETAIL */
function openMovieDetail(it){
  const poster=it.poster_path?IMAGE+it.poster_path:FALLBACK;
  const html=`
  <div class="overlayContent">
    <img src="${poster}">
    <div class="details">
      <h2>${it.title}</h2>
      <p><strong>Rating:</strong> ${(it.vote_average||0).toFixed(1)}</p>
      <p>${it.overview||"No description"}</p>
      <button class="season-btn" onclick="playMovie(${it.id})">Play Movie</button>
    </div>
  </div>`;
  openDetailHtml(html);
  saveRecentlyWatched(it,"movie");
}

/* TV DETAIL */
async function openTVDetail(it){
  try{
    const r=await fetch(`${API_URL}/tv/${it.id}?api_key=${API_KEY}`); 
    const tv=await r.json();
    const poster=tv.poster_path?IMAGE+tv.poster_path:FALLBACK;

    let seasons="";
    if(tv.seasons){
      seasons+=`<strong>Seasons:</strong><br>`;
      tv.seasons.forEach(s=>{
        seasons+=`<button class="season-btn" onclick="loadEpisodes(${tv.id},${s.season_number},this)">${s.name}</button>`;
      });
      seasons+=`<div id="episodesHolder" style="margin-top:12px"></div>`;
    }

    const html=`
    <div class="overlayContent">
      <img src="${poster}">
      <div class="details">
        <h2>${tv.name}</h2>
        <p><strong>Rating:</strong> ${(tv.vote_average||0).toFixed(1)}</p>
        <p>${tv.overview||"No description"}</p>
        ${seasons}
      </div>
    </div>`;
    openDetailHtml(html);
    saveRecentlyWatched(tv,"tv");
  }catch{
    openDetailHtml("Failed to load TV details");
  }
}

/* EPISODES */
async function loadEpisodes(id,s,btn){
  btn.parentElement.querySelectorAll(".season-btn").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  const h=$("#episodesHolder");
  h.innerHTML="Loading...";
  try{
    const d=await fetch(`${API_URL}/tv/${id}/season/${s}?api_key=${API_KEY}`).then(r=>r.json());
    h.innerHTML="";
    d.episodes.forEach(ep=>{
      const b=el("button","episode-btn");
      b.textContent=`${ep.episode_number}. ${ep.name}`;
      b.onclick=()=>playEpisode(id,s,ep.episode_number);
      h.appendChild(b);
    });
  }catch{ h.innerHTML="Failed to load episodes"; }
}

/* PLAYER */
function closeVideo(){ $("#player").src=""; $("#videoOverlay").style.display="none"; }
function playMovie(id){
  $("#player").src=`https://player.videasy.net/movie/${id}`;
  $("#videoOverlay").style.display="block";
}
function playEpisode(id,s,e){
  $("#player").src=`https://player.videasy.net/tv/${id}/${s}/${e}`;
  $("#videoOverlay").style.display="block";
}
$("#videoOverlay").onclick=e=>{ if(e.target.id==="videoOverlay") closeVideo(); };

/* SEARCH AUTOFILL */
let searchTimer=null;
$("#searchInput").oninput=()=>{
  clearTimeout(searchTimer);
  const v=$("#searchInput").value.trim();
  if(v.length<2){ $("#searchResults").innerHTML=""; return; }
  searchTimer=setTimeout(()=>combinedSearch(v),300);
};
async function combinedSearch(q){
  const out=$("#searchResults");
  out.innerHTML="Searching...";
  try{
    const [m,t]=await Promise.all([
      fetch(`${API_URL}/search/movie?api_key=${API_KEY}&query=${encodeURIComponent(q)}`).then(r=>r.json()),
      fetch(`${API_URL}/search/tv?api_key=${API_KEY}&query=${encodeURIComponent(q)}`).then(r=>r.json())
    ]);
    let all=[];
    if(m.results) all.push(...m.results.map(r=>({...r,_m:"movie"})));
    if(t.results) all.push(...t.results.map(r=>({...r,_m:"tv"})));
    all.sort((a,b)=>(b.popularity||0)-(a.popularity||0));
    out.innerHTML="";
    if(!all.length){ out.innerHTML="No results"; return; }
    all.forEach(i=>out.appendChild(createCard(i,i._m)));
  }catch{ out.innerHTML="Search failed"; }
}

/* INITIAL LOAD */
async function init(){
  renderRecentlyWatched();

  renderRow(`${API_URL}/movie/popular?api_key=${API_KEY}`,"#popularMovies","movie");
  renderRow(`${API_URL}/movie/top_rated?api_key=${API_KEY}`,"#topRatedMovies","movie");
  renderRow(`${API_URL}/movie/upcoming?api_key=${API_KEY}`,"#upcomingMovies","movie");
  renderRow(`${API_URL}/movie/now_playing?api_key=${API_KEY}`,"#nowPlayingMovies","movie");

  renderRow(`${API_URL}/tv/popular?api_key=${API_KEY}`,"#popularSeries","tv");
  renderRow(`${API_URL}/tv/top_rated?api_key=${API_KEY}`,"#topRatedSeries","tv");
  renderRow(`${API_URL}/tv/airing_today?api_key=${API_KEY}`,"#airingToday","tv");
  renderRow(`${API_URL}/tv/on_the_air?api_key=${API_KEY}`,"#onTheAir","tv");
}
init();
</script>

</body>
    </html>
