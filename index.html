<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Malfunction</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#050505;
  --panel:rgba(20,20,20,0.95);
  --card:rgba(30,30,30,0.95);
  --border:#2f2f2f;
  --accent:#ff2d2d;
  --text:#e0e0e0;
  --hover:#2a2a2a;
  --glow:#ff2d2d;
  --transition:all .3s ease;
}
*{box-sizing:border-box;}
body{
  margin:0;background:var(--bg);color:var(--text);
  font-family:'Segoe UI',Arial,sans-serif;
  height:100vh;overflow:hidden;
}

/* ===== Layout ===== */
#app{display:flex;height:100vh;}
#sidebar{
  width:220px;background:var(--panel);
  border-right:1px solid var(--border);
  padding:20px 10px;
  display:flex;flex-direction:column;gap:10px;
  height:100vh;overflow-y:auto;
}
#sidebar::-webkit-scrollbar{width:6px;}
#sidebar::-webkit-scrollbar-thumb{
  background:var(--border);border-radius:6px;
}
#sidebar button{
  background:none;border:none;color:var(--text);
  padding:12px;border-radius:8px;
  text-align:left;cursor:pointer;
  position:relative;
}
#sidebar button::after{
  content:"";position:absolute;left:0;bottom:0;
  width:0;height:2px;background:var(--accent);
  transition:var(--transition);
}
#sidebar button:hover::after,
#sidebar button.active::after{width:100%;}

#main{flex:1;display:flex;flex-direction:column;overflow:hidden;}
#topbar{
  height:56px;background:var(--panel);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;
  justify-content:space-between;
  padding:0 16px;font-size:1.3rem;
}

/* ===== Search ===== */
#search-container{position:relative;}
#search-input{
  width:220px;padding:6px 10px;
  background:var(--panel);border:1px solid var(--border);
  color:var(--text);border-radius:8px;
}
#search-results{
  position:absolute;top:36px;right:0;
  width:240px;max-height:300px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:8px;
  overflow-y:auto;display:none;
  z-index:1000;
}
.search-item{
  display:flex;gap:8px;
  padding:6px;border-radius:6px;
  cursor:pointer;
}
.search-item:hover{background:var(--hover);}
.search-item img{width:36px;height:36px;border-radius:6px;}
.search-item .name{font-weight:600;}

/* ===== Content ===== */
#content{flex:1;overflow:auto;padding:16px;}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:16px;
}
.card{
  background:var(--card);
  border-radius:14px;overflow:hidden;
  cursor:pointer;
}
.card:hover{transform:translateY(-4px);}
.card img{width:100%;aspect-ratio:1/1;object-fit:cover;}
.card h3{text-align:center;font-size:.9rem;padding:8px;}

.section-title{
  margin:16px 0 12px;
  color:var(--accent);font-weight:700;
}

/* ===== Game ===== */
iframe{
  width:100%;height:65vh;border:none;
  background:black;border-radius:12px;
  opacity:0;transition:.4s;
}
iframe.loaded{opacity:1;}
.game-actions-bar{
  display:flex;gap:8px;margin:8px 0;
}
.game-actions-bar button{
  background:var(--panel);
  border:1px solid var(--border);
  color:var(--text);
  padding:10px 14px;border-radius:10px;
  cursor:pointer;font-size:1.2rem;
}
.favorite.active{color:var(--accent);}

/* Clipboard popup */
#clipboard-popup{
  position:fixed;bottom:30px;left:50%;
  transform:translateX(-50%);
  background:var(--panel);padding:12px 20px;
  border-radius:12px;opacity:0;
  transition:.3s;pointer-events:none;
}
#clipboard-popup.show{opacity:1;}
</style>
</head>

<body>

<div id="app">
  <div id="sidebar"></div>

  <div id="main">
    <div id="topbar">
      <span>Home</span>
      <div id="search-container">
        <input id="search-input" placeholder="Search games...">
        <div id="search-results"></div>
      </div>
    </div>
    <div id="content"></div>
  </div>
</div>

<div id="clipboard-popup">Link copied!</div>

<script>
const JSON_URL="https://raw.githubusercontent.com/GLITCHED-OVERRIDE/Hypper-Drive-2/refs/heads/main/Games/Zones.json";
const ERROR_404="https://raw.githubusercontent.com/GLITCHED-OVERRIDE/Malfunction/refs/heads/main/Pages/404.html";

const ZONE_TYPES={
 "Home":"Home","PC":"PC","Mobile":"Moblie","N64":"N64","NDS":"NDS","PS1":"PS1",
 "Game Boy":"GB","Game Boy Advance":"GBA","Game Boy Color":"GBC",
 "NES":"NES","SNES":"SNES","Sega Genesis":"SG","Sega Saturn":"SS",
 "Neo Geo Pocket Color":"NGPC","MS-DOS":"MSDOS","Atari Jaguar":"AJ",
 "Arcade":"Arcade","Sega Game Gear":"SGG","Atari Lynx":"AL","Atari 2600":"A2600"
};

const sidebar=document.getElementById("sidebar");
const content=document.getElementById("content");

let allGames=[];
const recents=JSON.parse(localStorage.getItem("recentGames")||"[]");
const favorites=JSON.parse(localStorage.getItem("favoriteGames")||"[]");

/* Sidebar */
Object.keys(ZONE_TYPES).forEach(z=>{
 const b=document.createElement("button");
 b.textContent=z;
 b.onclick=()=>navigateZone(z);
 sidebar.appendChild(b);
});

function setActive(z){
 [...sidebar.children].forEach(b=>{
  b.classList.toggle("active",b.textContent===z);
 });
 document.querySelector("#topbar span").textContent=z;
}

function renderGrid(list){
 const g=document.createElement("div");
 g.className="grid";
 list.forEach(game=>{
  const c=document.createElement("div");
  c.className="card";
  c.innerHTML=`<img src="${game.cover}"><h3>${game.name}</h3>`;
  c.onclick=()=>openGame(game);
  g.appendChild(c);
 });
 return g;
}

/* Home */
function renderHome(){
 setActive("Home");
 content.innerHTML="";
 if(recents.length){
  content.innerHTML+=`<div class="section-title">Recently Played</div>`;
  content.appendChild(renderGrid(recents.slice(-10).reverse()));
 }
 if(favorites.length){
  content.innerHTML+=`<div class="section-title">Favorites</div>`;
  content.appendChild(renderGrid(favorites));
 }
}

/* Zones */
function renderZone(zone){
 setActive(zone);
 content.innerHTML="";
 const list=allGames.filter(g=>g.type.toLowerCase()===ZONE_TYPES[zone].toLowerCase());
 list.length?content.appendChild(renderGrid(list)):renderError();
}

/* Game */
async function openGame(game){
 history.pushState({}, "", `/games/${game.type}/${game.name}`);

 if(!recents.find(g=>g.name===game.name)){
  recents.push(game);
  localStorage.setItem("recentGames",JSON.stringify(recents));
 }

 const isFav=favorites.some(f=>f.name===game.name);

 content.innerHTML=`
  <iframe id="player" src="about:blank"></iframe>
  <div class="game-actions-bar">
   <button class="favorite ${isFav?"active":""}">â˜…</button>
   <button class="fullscreen">â›¶</button>
   <button class="share">ðŸ”—</button>
  </div>
  <div class="section-title">More Games</div>
 `;

 const iframe=document.getElementById("player");
 const html=await fetch(game.url).then(r=>r.text());
 iframe.contentWindow.document.open();
 iframe.contentWindow.document.write(html);
 iframe.contentWindow.document.close();
 iframe.classList.add("loaded");

 document.querySelector(".favorite").onclick=()=>{
  const i=favorites.findIndex(f=>f.name===game.name);
  i>-1?favorites.splice(i,1):favorites.push(game);
  localStorage.setItem("favoriteGames",JSON.stringify(favorites));
  document.querySelector(".favorite").classList.toggle("active");
 };

 document.querySelector(".fullscreen").onclick=()=>iframe.requestFullscreen();
 document.querySelector(".share").onclick=()=>{
  navigator.clipboard.writeText(location.href);
  const p=document.getElementById("clipboard-popup");
  p.classList.add("show");
  setTimeout(()=>p.classList.remove("show"),2000);
 };

 const more=allGames.filter(g=>g.type===game.type&&g.name!==game.name)
                    .sort(()=>.5-Math.random()).slice(0,10);
 content.appendChild(renderGrid(more));
}

/* Error */
async function renderError(){
 const iframe=document.createElement("iframe");
 iframe.src="about:blank";
 content.innerHTML=`<div class="section-title">404</div>`;
 content.appendChild(iframe);
 const html=await fetch(ERROR_404).then(r=>r.text());
 iframe.contentWindow.document.write(html);
 iframe.classList.add("loaded");
}

/* Router */
function navigateZone(z){
 history.pushState({}, "", `/games/${z}`);
 z==="Home"?renderHome():renderZone(z);
}
window.onpopstate=route;

function route(){
 const p=location.pathname.split("/");
 if(p[1]!=="games"){navigateZone("Home");return;}
 const z=decodeURIComponent(p[2]||"Home");
 z==="Home"?renderHome():renderZone(z);
}

/* Search */
const searchInput=document.getElementById("search-input");
const searchResults=document.getElementById("search-results");

searchInput.oninput=()=>{
 const q=searchInput.value.toLowerCase();
 searchResults.innerHTML="";
 if(!q){searchResults.style.display="none";return;}
 allGames.filter(g=>g.name.toLowerCase().includes(q)).forEach(g=>{
  const d=document.createElement("div");
  d.className="search-item";
  d.innerHTML=`<img src="${g.cover}"><div class="name">${g.name}</div>`;
  d.onclick=()=>{openGame(g);searchResults.style.display="none";};
  searchResults.appendChild(d);
 });
 searchResults.style.display="block";
};

/* Init */
fetch(JSON_URL).then(r=>r.json()).then(g=>{
 allGames=g;
 route();
});
</script>

</body>
</html>
